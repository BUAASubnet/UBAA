# UBAA (æ™ºæ…§åŒ—èˆª Remake)

![Kotlin](https://img.shields.io/badge/Kotlin-2.1.0-blue.svg?style=flat&logo=kotlin)
![Compose Multiplatform](https://img.shields.io/badge/Compose_Multiplatform-1.7.0-blueviolet.svg?style=flat&logo=jetpack-compose)
![Ktor](https://img.shields.io/badge/Ktor-3.0.0-orange.svg?style=flat&logo=ktor)
![Platform](https://img.shields.io/badge/Platform-Android%20%7C%20iOS%20%7C%20Desktop%20%7C%20Web-lightgrey.svg?style=flat)

**UBAA** æ˜¯ä¸€æ¬¾åŸºäº **Kotlin Multiplatform** å’Œ **Compose Multiplatform** æ„å»ºçš„ç°ä»£åŒ–è·¨å¹³å°åº”ç”¨ï¼Œä¸“ä¸ºåŒ—äº¬èˆªç©ºèˆªå¤©å¤§å­¦ï¼ˆBUAAï¼‰å­¦ç”Ÿæ‰“é€ ã€‚

å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæ›´æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„**æœåŠ¡èšåˆç½‘å…³**ã€‚é€šè¿‡ä¸“ç”¨çš„ Ktor åç«¯ï¼Œå®ƒå°†å¤æ‚çš„æ ¡å†…é—ç•™ç³»ç»Ÿï¼ˆå¦‚ CAS è®¤è¯ã€æ•™åŠ¡ç³»ç»Ÿã€åšé›…ç³»ç»Ÿï¼‰çš„æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–æ¸…æ´—ä¸èšåˆï¼Œä¸º Androidã€iOSã€Desktop å’Œ Web ç«¯ç”¨æˆ·æä¾›ç»Ÿä¸€ã€æµç•…ä¸”ç¾è§‚çš„ Material Design 3 ä½“éªŒã€‚

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§ (Features)

### ğŸ–¥ï¸ å¤šç«¯è¦†ç›–
*   **ğŸ“± Android / iOS**: åŸç”Ÿçº§æ€§èƒ½çš„ç§»åŠ¨ä½“éªŒã€‚
*   **ğŸ’» Desktop**: æ”¯æŒ Windows, macOS, Linux çš„æ¡Œé¢å®¢æˆ·ç«¯ã€‚
*   **ğŸŒ Web**: åŸºäº Wasm/JS çš„ç°ä»£ç½‘é¡µåº”ç”¨ï¼Œæ— éœ€å®‰è£…å³å¯ä½¿ç”¨ã€‚

### ğŸ“ æ™ºæ…§æ•™åŠ¡
*   **ğŸ” ç»Ÿä¸€è®¤è¯**: æ— ç¼é›†æˆ BUAA CAS ç»Ÿä¸€èº«ä»½è®¤è¯ï¼Œæ”¯æŒéªŒè¯ç è‡ªåŠ¨å¤„ç†ä¸ä¼šè¯ä¿æŒã€‚
*   **ğŸ“… æ™ºèƒ½è¯¾è¡¨**: å®æ—¶åŒæ­¥å­¦æœŸè¯¾è¡¨ï¼Œæ”¯æŒå‘¨æ¬¡åˆ‡æ¢ä¸è¯¦æƒ…æŸ¥çœ‹ã€‚
*   **ğŸ“ è€ƒåŠ¡åŠ©æ‰‹**: è€ƒè¯•å®‰æ’ä¸€é”®æŸ¥è¯¢ï¼Œä¸å†é”™è¿‡é‡è¦è€ƒè¯•ã€‚
*   **ğŸ›ï¸ ç©ºé—²æ•™å®¤**: å¿«é€ŸæŸ¥æ‰¾å…¨æ ¡å¯ç”¨è‡ªä¹ æ•™å®¤ã€‚
*   **ğŸ“ åšé›…å…¨èƒ½**: åšé›…è¯¾ç¨‹æŸ¥è¯¢ã€é€‰è¯¾ã€é€€è¯¾åŠ**è¿œç¨‹è‡ªä¸»ç­¾åˆ°**ã€‚
*   **âœ… è€ƒå‹¤ç­¾åˆ°**: æ”¯æŒç‰¹å®šè¯¾ç¨‹çš„äºŒç»´ç /ä½ç½®ç­¾åˆ°åŠŸèƒ½ã€‚

### ğŸ¨ å“è¶Šä½“éªŒ
*   **Material Design 3**: éµå¾ªæœ€æ–°è®¾è®¡è§„èŒƒï¼Œç•Œé¢ç°ä»£ã€æ•´æ´ã€‚
*   **æ·±è‰²æ¨¡å¼**: å®Œç¾é€‚é…ç³»ç»Ÿäº®è‰²/æ·±è‰²ä¸»é¢˜ã€‚
*   **æ›´æ–°æé†’**: å†…ç½®ç‰ˆæœ¬æ£€æŸ¥ï¼ŒåŠæ—¶è·å–æœ€æ–°åŠŸèƒ½ä¸ä¿®å¤ã€‚
*   **éšç§ç®¡ç†**ï¼šæœåŠ¡ç«¯ä¸å­˜å‚¨ä»»ä½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€æœ‰å†…å®¹å‡ç”±åŒ—èˆªå®˜æ–¹æœåŠ¡å™¨æä¾›ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Getting Started)

### ğŸ“‹ å‰ç½®æ¡ä»¶
*   **JDK**: 17 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
*   **IDE**: IntelliJ IDEA (æ¨è) æˆ– Android Studioã€‚
*   **Xcode**: ä»… iOS å¼€å‘éœ€è¦ (macOS)ã€‚

### 1ï¸âƒ£ å…‹éš†ä¸é…ç½®
```bash
git clone https://github.com/your-repo/UBAA.git
cd UBAA
cp .env.sample .env
# æ ¹æ®éœ€è¦ç¼–è¾‘ .env æ–‡ä»¶é…ç½®ç«¯å£ç­‰ä¿¡æ¯
```

### 2ï¸âƒ£ å¯åŠ¨åç«¯æœåŠ¡ (Server)
å®¢æˆ·ç«¯å¼ºä¾èµ–åç«¯ APIï¼Œè¯·**åŠ¡å¿…å…ˆå¯åŠ¨æœåŠ¡ç«¯**ã€‚

```bash
./gradlew :server:run
```
> æœåŠ¡ç«¯é»˜è®¤è¿è¡Œåœ¨ `http://0.0.0.0:5432`ã€‚

### 3ï¸âƒ£ å¯åŠ¨å®¢æˆ·ç«¯ (Client)

| å¹³å°        | å‘½ä»¤                                                | è¯´æ˜                |
| :---------- | :-------------------------------------------------- | :------------------ |
| **Android** | `./gradlew :composeApp:installDebug`                | è¿æ¥çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨    |
| **Desktop** | `./gradlew :composeApp:run`                         | è¿è¡Œæ¡Œé¢å®¢æˆ·ç«¯      |
| **Web**     | `./gradlew :composeApp:wasmJsBrowserDevelopmentRun` | å¯åŠ¨æœ¬åœ° Web æœåŠ¡å™¨ |
| **iOS**     | æ‰“å¼€ `iosApp/iosApp.xcworkspace`                    | ä½¿ç”¨ Xcode è¿è¡Œ     |

---

## âš™ï¸ é…ç½®ä¸ç¯å¢ƒ (Configuration)

é¡¹ç›®é…ç½®é€šè¿‡æ ¹ç›®å½•ä¸‹çš„ `.env` æ–‡ä»¶ç®¡ç†ã€‚å…³é”®é…ç½®é¡¹å¦‚ä¸‹ï¼š

| é…ç½®é¡¹         | é»˜è®¤å€¼                  | è¯´æ˜                           |
| :------------- | :---------------------- | :----------------------------- |
| `API_ENDPOINT` | `http://localhost:5432` | å®¢æˆ·ç«¯è¿æ¥çš„åç«¯åœ°å€           |
| `SERVER_PORT`  | `5432`                  | æœåŠ¡ç«¯ç›‘å¬ç«¯å£                 |
| `JWT_SECRET`   | *(éœ€ä¿®æ”¹)*              | ç”¨äºç­¾åç”¨æˆ· Token çš„å¯†é’¥      |
| `USE_VPN`      | `false`                 | æ˜¯å¦é€šè¿‡ WebVPN ä»£ç†è®¿é—®æ ¡å†…ç½‘ |

---

## ğŸ“Š ç›‘æ§ä¸è¿ç»´ (Observability)

æœåŠ¡ç«¯å†…ç½®äº†ä¼ä¸šçº§çš„ç›‘æ§ä¸æ—¥å¿—èƒ½åŠ›ï¼Œä¿éšœæœåŠ¡ç¨³å®šè¿è¡Œã€‚

*   **ğŸ“ˆ æŒ‡æ ‡ç›‘æ§ (Metrics)**:
    *   Endpoint: `GET /metrics`
    *   æ ¼å¼: Prometheus æ–‡æœ¬æ ¼å¼
    *   å†…å®¹: JVM å†…å­˜/GCã€HTTP è¯·æ±‚åå/å»¶è¿Ÿã€çº¿ç¨‹æ± çŠ¶æ€ç­‰ã€‚

*   **ğŸ“ æ—¥å¿—ç³»ç»Ÿ (Logging)**:
    *   **æ§åˆ¶å°**: å®æ—¶è¾“å‡º Info çº§åˆ«ä»¥ä¸Šæ—¥å¿—ã€‚
    *   **æ–‡ä»¶å½’æ¡£**: è‡ªåŠ¨å†™å…¥ `server/logs/server.log`ã€‚
        *   ç­–ç•¥: æŒ‰å¤©æ»šåŠ¨ï¼Œä¿ç•™ 30 å¤©å†å²ã€‚
        *   å†…å®¹: åŒ…å«å®Œæ•´çš„è¯·æ±‚é“¾è·¯è¿½è¸ª (Trace) å’Œå¼‚å¸¸å †æ ˆã€‚

---

## ğŸ— æŠ€æœ¯æ ˆä¸æ¶æ„ (Architecture)

æœ¬é¡¹ç›®é‡‡ç”¨ **Kotlin Multiplatform (KMP)** åˆ†å±‚æ¶æ„ï¼š

### ğŸ“‚ æ¨¡å—åˆ’åˆ†
*   **`composeApp` (UI å±‚)**
    *   åŸºäº **Compose Multiplatform**ã€‚
    *   åŒ…å«æ‰€æœ‰ç•Œé¢é€»è¾‘ã€ViewModel å’Œå¹³å°ç‰¹å®šçš„å…¥å£ä»£ç ã€‚
*   **`shared` (é¢†åŸŸå±‚)**
    *   **KMP å…±äº«æ¨¡å—**ï¼Œè¢«å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶å¼•ç”¨ã€‚
    *   å®šä¹‰äº†æ‰€æœ‰ **Data Models (DTOs)** å’Œ **API Interfaces**ï¼Œç¡®ä¿å‰åç«¯å¥‘çº¦ç»å¯¹ä¸€è‡´ã€‚
    *   åŒ…å«é€šç”¨çš„æ—¥æœŸå¤„ç†ã€åŠ å¯†ç®—æ³•ç­‰é€»è¾‘ã€‚
*   **`server` (åç«¯å±‚)**
    *   åŸºäº **Ktor Server**ã€‚
    *   ä½œä¸º API Gateway å’Œ Adapterï¼Œè´Ÿè´£ä¸å¤æ‚çš„æ ¡å†…æ—§ç³»ç»Ÿäº¤äº’ï¼ˆçˆ¬è™«/æ¨¡æ‹Ÿè¯·æ±‚ï¼‰ã€‚
    *   å¤„ç† JWT é‰´æƒã€Session ç®¡ç†å’Œæ•°æ®ç¼“å­˜ã€‚

### ğŸ›  å…³é”®æŠ€æœ¯
*   **Language**: Kotlin 2.0+
*   **UI**: Jetpack Compose / Compose Multiplatform
*   **Backend**: Ktor 3.x, Netty
*   **Build**: Gradle (Kotlin DSL), Version Catalog
*   **Libraries**: Koin (DI), Ktor Client, Coroutines, Serialization

---

## ğŸ§ª å¼€å‘æŒ‡å— (Development)

### è¿è¡Œæµ‹è¯•
æ‰§è¡Œå…¨é‡å•å…ƒæµ‹è¯•ï¼ˆåŒ…å« Shared å’Œ Server é€»è¾‘ï¼‰ï¼š
```bash
./gradlew test
```

### ä»£ç è¦†ç›–ç‡
ç”Ÿæˆ HTML æ ¼å¼çš„æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š (åŸºäº Kover)ï¼š
```bash
./gradlew koverHtmlReport
```
*   æŠ¥å‘Šè·¯å¾„: `build/reports/kover/html/index.html`

### ä»£ç è§„èŒƒ
æ‰§è¡Œ Lint æ£€æŸ¥ä»¥ç¡®ä¿ä»£ç é£æ ¼ä¸€è‡´ï¼š
```bash
./gradlew lint
```

---

## ğŸ“‚ ç›®å½•ç»“æ„æ¦‚è§ˆ

```text
UBAA/
â”œâ”€â”€ composeApp/          # å®¢æˆ·ç«¯ä¸»å·¥ç¨‹
â”‚   â”œâ”€â”€ src/commonMain   # æ ¸å¿ƒ UI ä»£ç  (Screens, Components)
â”‚   â”œâ”€â”€ src/androidMain  # Android å…¥å£
â”‚   â”œâ”€â”€ src/iosMain      # iOS å…¥å£
â”‚   â”œâ”€â”€ src/jvmMain      # Desktop å…¥å£
â”‚   â””â”€â”€ src/webMain      # Web å…¥å£
â”œâ”€â”€ server/              # åç«¯æœåŠ¡ä¸»å·¥ç¨‹
â”‚   â””â”€â”€ src/main/kotlin  # è·¯ç”±ã€ä¸šåŠ¡é€»è¾‘ã€çˆ¬è™«å®ç°
â”œâ”€â”€ shared/              # å…±äº«ä»£ç åº“ (KMP)
â”‚   â”œâ”€â”€ src/commonMain   # DTOs, Enums, Utils
â”œâ”€â”€ iosApp/              # iOS Xcode å·¥ç¨‹é…ç½®
â””â”€â”€ gradle/              # æ„å»ºé…ç½®ä¸ Version Catalog
```
